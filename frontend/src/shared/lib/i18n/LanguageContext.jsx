import {createContext, useContext, useState, useEffect} from 'react';

const translations = {
    en: {
        nav: {
            home: 'Home',
            courses: 'Courses',
            learning: 'Learning',
            shop: 'Shop',
            profile: 'Profile',
            settings: 'Settings',
            logout: 'Logout',
            menu: 'Menu',
            myCourses: 'My Courses'
        },
        common: {
            loading: 'Loading...',
            error: 'Error',
            back: 'Back'
        },
        pages: {
            courses: {
                title: 'Courses',
                subtitle: 'Browse available courses. After you enroll, they will appear on the Learning page.',
                viewDetails: 'View details →',
                noCourses: 'No courses available yet. Check back soon!',
                loading: 'Loading courses...',
                loadingCourse: 'Loading course...',
                courseNotFound: 'Course not found or failed to load.',
                courseNotFoundShort: 'Course not found.',
                backToCourses: '← Back to courses',
                backToCoursesTitle: '← Back to Courses',
                goToLearning: 'Go to learning →',
                enrolling: 'Enrolling...',
                enrollInCourse: 'Enroll in this course',
                failedToEnroll: 'Failed to enroll. Please try again.'
            },
            learning: {
                title: 'My Learning',
                subtitle: 'Courses you\'re currently enrolled in',
                continueLearning: 'Continue learning',
                noCourses: 'No courses yet',
                noCoursesText: 'You haven\'t enrolled in any courses. Browse our catalog to get started!',
                exploreCourses: 'Explore courses',
                testFailedTimeUp: 'Test failed – time is up',
                testPassed: 'Test passed',
                testNotPassed: 'Test not passed',
                timeExpired: 'Time expired before you finished the questions.',
                timedTestRequirement: 'Timed tests require 100% correct answers to pass.',
                allQuestionsCompleted: 'You have completed all questions.',
                correct: 'Correct',
                answered: 'Answered',
                accuracy: 'Accuracy',
                progress: 'Progress:',
                topics: 'topics',
                readMore: 'Read more',
                courseContent: 'Course Content',
                timedTest: 'Timed test',
                singleChoice: 'Single choice',
                multipleChoice: 'Multiple choice',
                code: 'Code',
                noTopicsYet: 'No topics yet.',
                noModulesYet: 'No modules yet.',
                loadingTestHistory: 'Loading test history...',
                noAnsweredQuestions: 'No answered questions to display.',
                correctAnswer: 'Correct answer!',
                incorrectAnswer: 'Incorrect answer.',
                failedToLoadNextQuestion: 'Failed to load next question.',
                failedToSubmitAnswer: 'Failed to submit answer. Please try again.',
                failedToRestartTest: 'Failed to restart the test. Please try again.',
                failedToLoadTopic: 'Failed to load topic.',
                failedToLoadTestHistory: 'Failed to load test history.',
                topicNotFound: 'Topic not found or you are not enrolled.',
                notEnrolled: 'You are not enrolled in this course.',
                historyAvailableAfterFinish: 'History is available only after you finish this topic.',
                timedTestInProgress: 'Timed test in progress. Navigation is locked until you finish or exit the test.',
                loadingTopic: 'Loading topic...',
                backToMyLearning: '← Back to My Learning',
                backToCourse: '← Back to course',
                backToResults: 'Back to results',
                backToTheory: '← Back to theory',
                theory: 'Theory',
                goToPractice: 'Start test',
                courseNotFoundOrNotEnrolled: 'Course not found or you are not enrolled.',
                failedToLoadCourse: 'Failed to load course.',
                failedToLoadCourses: 'Failed to load your courses.',
                answerAccepted: 'Answer accepted!',
                loadingQuestion: 'Loading question...',
                loadingCourse: 'Loading course...',
                courseNotFound: 'Course not found.'
            },
            settings: {
                title: 'Settings',
                theme: 'Theme',
                lightTheme: 'Light',
                darkTheme: 'Dark',
                language: 'Language',
                english: 'English',
                slovak: 'Slovak',
                account: 'Account',
                overview: 'Overview',
                status: 'Status',
                active: 'Active',
                created: 'Created',
                role: 'Role',
                roleStudent: 'Student',
                roleTeacher: 'Teacher',
                roleAdmin: 'Admin',
                connections: 'Connections',
                connected: 'Connected',
                notConnected: 'Not connected',
                connect: 'Connect',
                disconnect: 'Disconnect',
                accountDeletionNote: 'Account deletion will be added later.',
                failedToDisconnect: 'Failed to disconnect. Please try again.',
                googleOAuthNotConfigured: 'Google OAuth is not configured.'
            },
            shop: {
                title: 'Shop',
                subtitle: 'Purchase courses and materials'
            },
            home: {
                title: 'Home',
                subtitle: 'Welcome to the learning system',
                featuredCourses: 'Featured Courses',
                goToCatalog: 'Go to catalog',
                openShop: 'Open shop',
                loadingCourses: 'Loading courses...',
                noCoursesAvailable: 'No courses available yet.',
                latestUpdates: 'Latest Updates',
                shop: 'Shop',
                shopRedesigning: 'The shop is being redesigned. We\'ll add it back once the earning and spending logic is defined.',
                whatsELearning: 'What\'s E-Learning Platform?',
                whatsELearningText1: 'This is a modern, focused e-learning platform designed to help you connect theory and practice for programming languages like Python and many other topics.',
                whatsELearningText2: 'Instead of just watching long video courses, you\'ll read concise lessons and immediately apply concepts through quizzes and coding tasks directly in the browser.'
            },
            profile: {
                accountInformation: 'Account Information',
                editProfile: 'Edit Profile',
                saveChanges: 'Save Changes',
                cancel: 'Cancel',
                enterUsername: 'Enter username',
                clickEditToChangeUsername: 'Click "Edit Profile" above to change username',
                usernameMustBeUnique: 'Username must be unique. If it\'s already taken, you\'ll see an error message.',
                emailCannotBeChanged: 'Email cannot be changed',
                avatar: 'Avatar',
                change: 'Change',
                user: 'User',
                noEmailProvided: 'No email provided',
                editProfileAppearance: 'Edit profile appearance',
                save: 'Save',
                chooseBackgroundGradient: 'Choose Background Gradient:',
                previousPage: 'Previous page',
                nextPage: 'Next page',
                none: 'None',
                avatarSizeError: 'Avatar image must be less than 5MB',
                avatarFileTypeError: 'Please select an image file',
                avatarReadError: 'Failed to read image file',
                profileInfoUpdated: 'Profile information updated successfully!',
                profileAppearanceUpdated: 'Profile appearance updated successfully!',
                usernameTaken: 'This username is already taken. Please choose another one.',
                failedToUpdate: 'Failed to update profile. Please try again.'
            },
            teacher: {
                title: 'My Courses',
                subtitle: 'Manage your courses',
                createCourse: 'Create New Course',
                noCourses: 'You haven\'t created any courses yet.',
                createFirst: 'Create Your First Course'
            },
            landing: {
                title: 'Easy Learn',
                subtitle: 'Your journey to knowledge starts here',
                logIn: 'Log In',
                registration: 'Registration',
                explore: 'Explore'
            },
            auth: {
                login: 'Log in',
                register: 'Sign up',
                welcomeBack: 'Welcome Back!',
                continueLearning: 'Continue your learning journey and explore new courses to expand your knowledge.',
                chooseLoginMethod: 'Choose your preferred login method',
                continueGoogle: 'Continue with Google',
                continueGitHub: 'Continue with GitHub',
                useEmailPassword: 'Use email / password',
                loggingIn: 'Logging in...',
                signingIn: 'Signing in...',
                backToOptions: '← Back to other options',
                dontHaveAccount: 'Don\'t have an account?',
                alreadyHaveAccount: 'Already have an account?',
                startJourney: 'Start Your Learning Journey',
                joinLearners: 'Join thousands of learners and start mastering new skills today.',
                createAccount: 'Create Account',
                chooseSignupMethod: 'Choose your preferred signup method',
                signingUp: 'Signing up...',
                creatingAccount: 'Creating account...',
                username: 'Username',
                chooseUsername: 'Choose a username',
                usernameOrEmail: 'Username or Email',
                enterUsernameOrEmail: 'Enter your username or email',
                email: 'Email',
                yourEmail: 'Your email',
                password: 'Password',
                enterPassword: 'Enter your password',
                createPassword: 'Create a password',
                firstName: 'First name',
                yourFirstName: 'Your first name',
                lastName: 'Last name',
                yourLastName: 'Your last name',
                loginFailed: 'Login failed. Invalid username or password.',
                or: 'or',
                createAccountButton: 'Create account',
                registrationFailed: 'Registration failed. Username or email may already be taken.',
                googleAuthFailed: 'Google authentication failed. Please try again.',
                googleOAuthNotConfigured: 'Google OAuth is not configured. Please contact support.',
                googleSignInFailed: 'Failed to initialize Google Sign-In. Please try again.',
                googleSignInLoadFailed: 'Google Sign-In failed to load. Please refresh the page.',
                githubAuthFailed: 'GitHub authentication failed. Please try again.',
                submitAnswer: 'Submit answer',
                nextQuestion: 'Next question',
                finishTest: 'Finish test',
                retry: 'Retry',
                tryAgain: 'Try again',
                submitting: 'Submitting...',
                saving: 'Saving...',
                viewTestHistory: 'View test history',
                historyOpened: 'History opened'
            }
        }
    },
    sk: {
        nav: {
            home: 'Domov',
            courses: 'Kurzy',
            learning: 'Vzdelávanie',
            shop: 'Obchod',
            profile: 'Profil',
            settings: 'Nastavenia',
            logout: 'Odhlásiť sa',
            menu: 'Menu',
            myCourses: 'Moje kurzy'
        },
        common: {
            loading: 'Načítavanie...',
            error: 'Chyba',
            back: 'Späť'
        },
        pages: {
            courses: {
                title: 'Kurzy',
                subtitle: 'Prehľadajte dostupné kurzy. Po prihlásení sa objavia na stránke Vzdelávanie.',
                viewDetails: 'Zobraziť detaily →',
                noCourses: 'Zatiaľ nie sú k dispozícii žiadne kurzy. Skúste to neskôr!',
                loading: 'Načítavanie kurzov...',
                loadingCourse: 'Načítavanie kurzu...',
                courseNotFound: 'Kurz sa nenašiel alebo sa nepodarilo načítať.',
                courseNotFoundShort: 'Kurz sa nenašiel.',
                backToCourses: '← Späť na kurzy',
                backToCoursesTitle: '← Späť na kurzy',
                goToLearning: 'Prejsť na vzdelávanie',
                enrolling: 'Prihlasovanie...',
                enrollInCourse: 'Prihlásiť sa na tento kurz',
                failedToEnroll: 'Prihlásenie zlyhalo. Skúste to znova.'
            },
            learning: {
                title: 'Moje vzdelávanie',
                subtitle: 'Kurzy, na ktoré ste prihlásení',
                continueLearning: 'Pokračovať v učení →',
                noCourses: 'Zatiaľ žiadne kurzy',
                noCoursesText: 'Ešte ste sa neprihlásili na žiadne kurzy. Prehľadajte náš katalóg a začnite!',
                exploreCourses: 'Preskúmať kurzy',
                testFailedTimeUp: 'Test zlyhal – čas vypršal',
                testPassed: 'Test úspešný',
                testNotPassed: 'Test neúspešný',
                timeExpired: 'Čas vypršal pred dokončením otázok.',
                timedTestRequirement: 'Časované testy vyžadujú 100% správnych odpovedí na úspešné dokončenie.',
                allQuestionsCompleted: 'Dokončili ste všetky otázky.',
                correct: 'Správne',
                answered: 'Odpovedané',
                accuracy: 'Presnosť',
                progress: 'Pokrok:',
                topics: 'tém',
                readMore: 'Čítať viac',
                courseContent: 'Obsah kurzu',
                timedTest: 'Časovaný test',
                singleChoice: 'Jedna možnosť',
                multipleChoice: 'Viaceré možnosti',
                code: 'Kód',
                statusNotStarted: 'Nezačaté',
                statusInProgress: 'Prebieha',
                statusCompleted: 'Dokončené',
                statusFailed: 'Neprešiel',
                statusPassed: 'Prešiel',
                noTopicsYet: 'Zatiaľ žiadne témy.',
                noModulesYet: 'Zatiaľ žiadne moduly.',
                loadingTestHistory: 'Načítavanie histórie testu...',
                noAnsweredQuestions: 'Žiadne zodpovedané otázky na zobrazenie.',
                correctAnswer: 'Správna odpoveď!',
                incorrectAnswer: 'Nesprávna odpoveď.',
                failedToLoadNextQuestion: 'Načítanie ďalšej otázky zlyhalo.',
                failedToSubmitAnswer: 'Odoslanie odpovede zlyhalo. Skúste to znova.',
                failedToRestartTest: 'Reštartovanie testu zlyhalo. Skúste to znova.',
                failedToLoadTopic: 'Načítanie témy zlyhalo.',
                failedToLoadTestHistory: 'Načítanie histórie testu zlyhalo.',
                topicNotFound: 'Téma sa nenašla alebo nie ste prihlásení.',
                notEnrolled: 'Nie ste prihlásení na tento kurz.',
                historyAvailableAfterFinish: 'História je dostupná až po dokončení tejto témy.',
                timedTestInProgress: 'Časovaný test prebieha. Navigácia je uzamknutá, kým test nedokončíte alebo neukončíte.',
                loadingTopic: 'Načítavanie témy...',
                backToMyLearning: '← Späť na Moje vzdelávanie',
                backToCourse: '← Späť na kurz',
                backToResults: 'Späť na výsledky',
                backToTheory: '← Späť na teóriu',
                theory: 'Teória',
                goToPractice: 'Začať test',
                courseNotFoundOrNotEnrolled: 'Kurz sa nenašiel alebo nie ste prihlásení.',
                failedToLoadCourse: 'Načítanie kurzu zlyhalo.',
                failedToLoadCourses: 'Načítanie vašich kurzov zlyhalo.',
                answerAccepted: 'Odpoveď prijatá!',
                loadingQuestion: 'Načítavanie otázky...',
                loadingCourse: 'Načítavanie kurzu...',
                courseNotFound: 'Kurz sa nenašiel.'
            },
            settings: {
                title: 'Nastavenia',
                theme: 'Téma',
                lightTheme: 'Svetlá',
                darkTheme: 'Tmavá',
                language: 'Jazyk',
                english: 'Angličtina',
                slovak: 'Slovenčina',
                account: 'Účet',
                overview: 'Prehľad',
                status: 'Stav',
                active: 'Aktívny',
                created: 'Vytvorený',
                role: 'Rola',
                roleStudent: 'Študent',
                roleTeacher: 'Učiteľ',
                roleAdmin: 'Administrátor',
                connections: 'Pripojenia',
                connected: 'Pripojené',
                notConnected: 'Nepripojené',
                connect: 'Pripojiť',
                disconnect: 'Odpojiť',
                accountDeletionNote: 'Odstránenie účtu bude pridané neskôr.',
                failedToDisconnect: 'Odpojenie zlyhalo. Skúste to znova.',
                googleOAuthNotConfigured: 'Google OAuth nie je nakonfigurovaný.'
            },
            shop: {
                title: 'Obchod',
                subtitle: 'Nákup kurzov a materiálov'
            },
            home: {
                title: 'Domov',
                subtitle: 'Vitajte v systéme vzdelávania',
                featuredCourses: 'Odporúčané kurzy',
                goToCatalog: 'Prejsť do katalógu',
                openShop: 'Otvoriť obchod',
                loadingCourses: 'Načítavanie kurzov...',
                noCoursesAvailable: 'Zatiaľ nie sú k dispozícii žiadne kurzy.',
                latestUpdates: 'Najnovšie aktualizácie',
                shop: 'Obchod',
                shopRedesigning: 'Obchod sa prerába. Pridáme ho späť, keď bude definovaná logika zarábania a míňania.',
                whatsELearning: 'Čo je E-Learning Platforma?',
                whatsELearningText1: 'Toto je moderná, zameraná e-learningová platforma navrhnutá tak, aby vám pomohla spojiť teóriu a prax pre programovacie jazyky ako Python a mnoho ďalších tém.',
                whatsELearningText2: 'Namiesto sledovania dlhých video kurzov budete čítať stručné lekcie a okamžite aplikovať koncepty prostredníctvom kvízov a kódovacích úloh priamo v prehliadači.'
            },
            profile: {
                accountInformation: 'Informácie o účte',
                editProfile: 'Upraviť profil',
                saveChanges: 'Uložiť zmeny',
                cancel: 'Zrušiť',
                enterUsername: 'Zadajte používateľské meno',
                clickEditToChangeUsername: 'Kliknite na "Upraviť profil" vyššie, aby ste zmenili používateľské meno',
                usernameMustBeUnique: 'Používateľské meno musí byť jedinečné. Ak je už obsadené, uvidíte chybovú správu.',
                emailCannotBeChanged: 'Email sa nedá zmeniť',
                avatar: 'Avatar',
                change: 'Zmeniť',
                user: 'Používateľ',
                noEmailProvided: 'Email nie je poskytnutý',
                editProfileAppearance: 'Upraviť vzhľad profilu',
                save: 'Uložiť',
                chooseBackgroundGradient: 'Vyberte pozadie gradientu:',
                previousPage: 'Predchádzajúca stránka',
                nextPage: 'Ďalšia stránka',
                none: 'Žiadny',
                avatarSizeError: 'Obrázok avatara musí byť menší ako 5MB',
                avatarFileTypeError: 'Vyberte súbor obrázka',
                avatarReadError: 'Načítanie súboru obrázka zlyhalo',
                profileInfoUpdated: 'Informácie o profile boli úspešne aktualizované!',
                profileAppearanceUpdated: 'Vzhľad profilu bol úspešne aktualizovaný!',
                usernameTaken: 'Toto používateľské meno je už obsadené. Vyberte si iné.',
                failedToUpdate: 'Aktualizácia profilu zlyhala. Skúste to znova.'
            },
            teacher: {
                title: 'Moje kurzy',
                subtitle: 'Spravujte svoje kurzy',
                createCourse: 'Vytvoriť nový kurz',
                noCourses: 'Ešte ste nevytvorili žiadne kurzy.',
                createFirst: 'Vytvorte svoj prvý kurz'
            },
            landing: {
                title: 'Easy Learn',
                subtitle: 'Vaša cesta k vedomostiam začína tu',
                logIn: 'Prihlásiť sa',
                registration: 'Registrácia',
                explore: 'Preskúmať'
            },
            auth: {
                login: 'Prihlásiť sa',
                register: 'Registrovať sa',
                welcomeBack: 'Vitajte späť!',
                continueLearning: 'Pokračujte vo vašej vzdelávacej ceste a preskúmajte nové kurzy na rozšírenie vašich vedomostí.',
                chooseLoginMethod: 'Vyberte preferovaný spôsob prihlásenia',
                continueGoogle: 'Pokračovať s Google',
                continueGitHub: 'Pokračovať s GitHub',
                useEmailPassword: 'Použiť email / heslo',
                loggingIn: 'Prihlasovanie...',
                signingIn: 'Prihlasovanie...',
                backToOptions: '← Späť na ďalšie možnosti',
                dontHaveAccount: 'Nemáte účet?',
                alreadyHaveAccount: 'Už máte účet?',
                startJourney: 'Začnite svoju vzdelávaciu cestu',
                joinLearners: 'Pripojte sa k tisíckam študentov a začnite ovládať nové zručnosti ešte dnes.',
                createAccount: 'Vytvoriť účet',
                chooseSignupMethod: 'Vyberte preferovaný spôsob registrácie',
                signingUp: 'Registrácia...',
                creatingAccount: 'Vytváranie účtu...',
                username: 'Používateľské meno',
                chooseUsername: 'Vyberte používateľské meno',
                usernameOrEmail: 'Používateľské meno alebo Email',
                enterUsernameOrEmail: 'Zadajte vaše používateľské meno alebo email',
                email: 'Email',
                yourEmail: 'Váš email',
                password: 'Heslo',
                enterPassword: 'Zadajte vaše heslo',
                createPassword: 'Vytvorte heslo',
                firstName: 'Meno',
                yourFirstName: 'Vaše meno',
                lastName: 'Priezvisko',
                yourLastName: 'Vaše priezvisko',
                loginFailed: 'Prihlásenie zlyhalo. Neplatné používateľské meno alebo heslo.',
                or: 'alebo',
                createAccountButton: 'Vytvoriť účet',
                registrationFailed: 'Registrácia zlyhala. Používateľské meno alebo email už môže byť obsadené.',
                googleAuthFailed: 'Google autentifikácia zlyhala. Skúste to znova.',
                googleOAuthNotConfigured: 'Google OAuth nie je nakonfigurovaný. Kontaktujte podporu.',
                googleSignInFailed: 'Inicializácia Google Sign-In zlyhala. Skúste to znova.',
                googleSignInLoadFailed: 'Google Sign-In sa nepodarilo načítať. Obnovte stránku.',
                githubAuthFailed: 'GitHub autentifikácia zlyhala. Skúste to znova.',
                submitAnswer: 'Odoslať odpoveď',
                nextQuestion: 'Ďalšia otázka',
                finishTest: 'Dokončiť test',
                retry: 'Skúsiť znova',
                tryAgain: 'Skúsiť znova',
                submitting: 'Odosielanie...',
                saving: 'Ukladanie...',
                viewTestHistory: 'Zobraziť históriu testu',
                historyOpened: 'História otvorená'
            }
        }
    }
};

const LanguageContext = createContext();

export function LanguageProvider({children}) {
    const [language, setLanguage] = useState(() => {
        const saved = localStorage.getItem('language');
        return saved || 'en';
    });

    useEffect(() => {
        localStorage.setItem('language', language);
    }, [language]);

    const t = (key) => {
        const keys = key.split('.');
        let value = translations[language];
        for (const k of keys) {
            value = value?.[k];
        }
        return value || key;
    };

    return (
        <LanguageContext.Provider value={{language, setLanguage, t}}>
            {children}
        </LanguageContext.Provider>
    );
}

export function useLanguage() {
    const context = useContext(LanguageContext);
    if (!context) {
        throw new Error('useLanguage must be used within LanguageProvider');
    }
    return context;
}
